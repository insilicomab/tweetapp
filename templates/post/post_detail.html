{% extends 'base.html' %}
{% block content %}
<div class="main posts-show">
    <div class="container">
      <div class="posts-show-item">
        <div class="post-user-name">
          <img src="{{ post.user.picture.url }}">
          <a href="{% url 'accounts:user_detail' user_id=post.user.id %}">{{ post.user.username }}</a>
        </div>
        <p>
          {{ post.content }}
        </p>
        <div class="post-time">
          {{ post.created_at }}
        </div>

        <form action="" method="POST">{% csrf_token %}
          {% if liked %}
            <span class="fa fa-heart like-btn-unlike"></span>
          {% else %}
            <span class="fa fa-heart like-btn"></span>
          {% endif %}
        </form>
        {{ likes_count }}

        {% if request.user.id == post.user.id %}
          <div class="post-menus">
            <a href="{% url 'post:edit_post' post_id=post.id %}">編集</a>
            <a href="{% url 'post:delete_post' post_id=post.id %}">削除</a>
          </div>
        {% endif %}
      </div>
    </div>
</div>
{% endblock content %}


<script type="text/javascript">
  $(document).ready(function(event){
      $(document).on('click', '#like', function(event){
          event.preventDefault();
          $.ajax({
              type: 'POST',
              url: "{% url 'post:likefunc' %}",
              data: {
                  'post_id': $(this).attr('name'),
                  'csrfmiddlewaretoken': '{{ csrf_token }}'},
              dataType: 'json',
              success: function(response){
                  selector = document.getElementsByName(response.post_id);
                  if(response.liked){
                      $(selector).html("<i class='fas fa-lg fa-heart'></i>");
                  }
                  else {
                      $(selector).html("<i class='far fa-lg fa-heart'></i>");
                  }
                  selector2 = document.getElementsByName(response.post_id + "-count");
                  $(selector2).text(response.count);
              }
          });
      });
  });
</script>